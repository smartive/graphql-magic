# Graphql querying

For autocompletion of your queries, you can create the following `apollo.config.js` file:

```ts
module.exports = {
  client: {
    service: {
      name: 'your-project',
      localSchemaFile: './src/generated/schema.graphql',
    },
    includes: ['./src/**/*.ts', './src/**/*.tsx'],
  },
};
```

## `executeQuery`

`graphql-magic` generates an `executeQuery` function for you, which you can adapt to your needs.

It handles things such as:

* user authentication (see the [Tutorial](./tutorial) for an example with auth0)
* custom resolvers (see [Custom resolvers](./custom-resolvers))
* mutation hooks (see [Mutation hooks](./mutation-hooks))

TODO


## Queries

Typically, you'll put graphql queries in `src/graphql/client/queries`, e.g. `get-posts.ts`

```ts
import { gql } from '@smartive/graphql-magic';

export const GET_POSTS = gql`
  query GetPosts {
    posts {
        id
        title
        content
        createdBy {
            username
        }
        comments {
            id
            createdBy {
                username
            }
            content
        }
    }
  }
`;
```

The query can then be used like so:

```tsx
import { GetMeQuery, GetPostsQuery } from "@/generated/client";
import { GET_POSTS } from "@/graphql/client/queries/get-posts";
import { executeGraphql } from "@/graphql/execute";

async function Posts({ me }: { me: GetMeQuery['me'] }) {
  const { data: { posts } } = await executeGraphql<GetPostsQuery>({ query: GET_POSTS })

  return <div>
    {posts.map(post => <div key={post.id}>
      <article>
        <h2>{post.title}</h2>
        <div>by {post.createdBy.username}</div>
        <p>{post.content}</p>
        <h4>Comments</h4>
        {post.comments.map(comment => (<div key={comment.id}>
          <div>{comment.createdBy.username}</div>
          <p>{comment.content}</p> by {comment.createdBy.username}
        </div>)
        )}
      </article>
    </div>)}
  </div>
}
```

Client-side: TODO

## Mutations

Mutation queries are generated by `graphql-magic` directly so you don't need to write them. Use like this:

```tsx
import { CreatePostMutationMutation, CreatePostMutationMutationVariables } from "@/generated/client";
import { CREATE_POST } from "@/generated/client/mutations";
import { executeGraphql } from "@/graphql/execute";
import { revalidatePath } from "next/cache";

async function CreatePost() {
  async function createPost(formData: FormData) {
    'use server'
    await executeGraphql<CreatePostMutationMutation, CreatePostMutationMutationVariables>({
      query: CREATE_POST,
      variables: {
        data: {
          title: formData.get('title') as string,
          content: formData.get('content') as string
        }
      }
    })
    revalidatePath('/')
  }

  return <form action={createPost}>
    <h2>New Post</h2>
    <label>
      <span>Title</span>
      <input name="title" />
    </label>
    <label>
      <span>Content</span>
      <textarea rows={5} name="content" />
    </label>
    <div>
      <button type="submit">Create</button>
    </div>
  </form>
}
```

Client-side: TODO
