"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[584],{9660:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"permissions","title":"Permissions","description":"Permissions are an object provided to the execute function.","source":"@site/docs/8-permissions.md","sourceDirName":".","slug":"/permissions","permalink":"/graphql-magic/docs/permissions","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{},"sidebar":"sidebar","previous":{"title":"Graphql querying","permalink":"/graphql-magic/docs/graphql-client"},"next":{"title":"Polymorphism (TODO)","permalink":"/graphql-magic/docs/polymorphism"}}');var i=s(4848),t=s(8453);const a={},o="Permissions",l={},c=[{value:"Grant all permissions",id:"grant-all-permissions",level:2},{value:"Actions",id:"actions",level:2},{value:"Linking",id:"linking",level:2},{value:"Narrowing the record set",id:"narrowing-the-record-set",level:2},{value:"Derivative permissions",id:"derivative-permissions",level:2},{value:"Me",id:"me",level:2}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"permissions",children:"Permissions"})}),"\n",(0,i.jsxs)(n.p,{children:["Permissions are an object provided to the ",(0,i.jsx)(n.code,{children:"execute"})," function.\nThe root keys of the objects are the user roles (including the special role ",(0,i.jsx)(n.code,{children:"UNAUTHENTICATED"})," for when the user object is undefined)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"execute({\n    ...\n    user: {\n        // ...\n        role: 'USER' // this is the role that will apply\n    },\n    permissions: {\n        ADMIN: ... // admin permissions\n        USER: ... // user permissions\n        UNAUTHENTICATED: ... // permissions for unauthenticated users\n    }\n})\n"})}),"\n",(0,i.jsx)(n.h2,{id:"grant-all-permissions",children:"Grant all permissions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"ADMIN: true\n"})}),"\n",(0,i.jsx)(n.h2,{id:"actions",children:"Actions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"READ"}),"\n",(0,i.jsx)(n.li,{children:"CREATE"}),"\n",(0,i.jsx)(n.li,{children:"UPDATE"}),"\n",(0,i.jsx)(n.li,{children:"DELETE"}),"\n",(0,i.jsx)(n.li,{children:"RESTORE"}),"\n",(0,i.jsx)(n.li,{children:"LINK"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Grant all READ permissions on a specific table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"User: {} // same as User: { READ: true }\n"})}),"\n",(0,i.jsx)(n.p,{children:"Grant actions other than READ on a specific table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"User: { CREATE: true }\n"})}),"\n",(0,i.jsx)(n.h2,{id:"linking",children:"Linking"}),"\n",(0,i.jsxs)(n.p,{children:["The LINK permission doesn't give one permission to modify these records,\nbut to use them as options for foreign keys in ",(0,i.jsx)(n.em,{children:"other"})," records that one does have the permission to CREATE/UPDATE."]}),"\n",(0,i.jsx)(n.p,{children:"So, for example, if you want a manager to be able to assign a user to a task, you would model it like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"MANAGER: {\n  User: { LINK: true }\n  Task: { UPDATE: true }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"narrowing-the-record-set",children:"Narrowing the record set"}),"\n",(0,i.jsx)(n.p,{children:"Use WHERE, which accepts simple table column/value pairs that are then used as sql where filter."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"GUEST: {\n  Post: {\n    WHERE: { published: true }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"derivative-permissions",children:"Derivative permissions"}),"\n",(0,i.jsx)(n.p,{children:"In the following way you can define permissions that follow the relational structure."}),"\n",(0,i.jsx)(n.p,{children:'"If I can read a board (because it is public), then I can follow all threads and their authors, and their replies, which I can like."'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"GUEST: {\n  Board: {\n    WHERE: { public: true }\n    RELATIONS: {\n      threads: {\n        RELATIONS: {\n          LINK: true,\n          author: {},\n          replies: {\n            CREATE: true,\n            LINK: true,\n            likes: {\n              CREATE: true\n            }\n          }\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"me",children:"Me"}),"\n",(0,i.jsxs)(n.p,{children:["You can use ",(0,i.jsx)(n.code,{children:"me"})," as a special ",(0,i.jsx)(n.code,{children:"User"})," record set containing just yourself."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"EMPLOYEE: {\n  me: {\n    UPDATE: true,\n    LINK: true,\n    RELATIONS: {\n      tasks: {\n        UPDATE: true\n      }\n    }\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Note: for ownership patterns (I own what I create, I can update what I own),\none must use implicitly generated relationships such as ",(0,i.jsx)(n.code,{children:"createdPosts"}),", ",(0,i.jsx)(n.code,{children:"updatedPosts"}),", ",(0,i.jsx)(n.code,{children:"deletedPosts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'GUEST: {\n  me: {\n    LINK: true,\n    RELATIONS: {\n      createdPosts: {\n        // "guests can create a post with the field createdBy === me"\n        CREATE: true,\n        UPDATE: true\n      },\n      updatedPosts: {\n        // this is necessary or it won\'t be possible to create a post\n        // "guests can create a post with the field updatedBy === me"\n        CREATE: true\n\n        // this is *not* necessary because the user can already update posts they created\n        // UPDATE: true\n      }\n    }\n  }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var r=s(6540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);